<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R6CC - Lobby</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/lobby.css">
    <script src="https://kit.fontawesome.com/42d2b3af0b.js" crossorigin="anonymous"></script>
    <script src="./funcoes.js"></script>
</head>

<body>
    <header class="menu">
        <div><img src="img/logo.png" class="logo"></div>
        <ul class="lista l-menu">
            <li><a href="index.html" class="btn">Home</a></li>
            <li><a href="lobby.html" class="btn ativo">Procurar lobby</a></li>
            <li><a href="leaderboard.html" class="btn">Leaderboard</a></li>
            <li><a href="login.html" class="btn">Entrar/Cadastro</a></li>
        </ul>
    </header>

    <div class="container">
        <h2>Olá, <span id="b_usuario"></span></h2><span onclick="logoff()" class="btn-sair">Sair</span>
    </div>
    <div class="container">
        
        <button class="btn" onclick="buscarLobby()">Procurar lobby</button>
        <div style="display:none" id="div_adversario">Seu adversario é: <b id="b_adversario"></b></div>
        <div class="resultado">
            <div id="jogadores"></div>
            <div id="mapa">
                <h3 style="display: none;" id="h3_mapa">Mapa:</h3>
                <ul class="ul_mappool" id="lmapas">
                    <h1>Map Pool:</h1>
                    <li id="fronteira" class="item">
                        <img src="img/mapas/fronteira.jpg">
                        <div class="caixa">Fronteira</div>
                    </li>
                    <li id="consulado" class="item">
                        <img src="img/mapas/consulado.jpg">
                        <div class="caixa">Consulado</div>
                    </li>
                    <li id="casa_de_campo" class="item">
                        <img src="img/mapas/campo.jpg">
                        <div class="caixa">Casa de campo</div>
                    </li>
                    <li id="mansao" class="item">
                        <img src="img/mapas/mansao.jpg">
                        <div class="caixa">Mansão</div>
                    </li>
                    <li id="cafe_dostoyevsky" class="item">
                        <img src="img/mapas/cafe.jpg">
                        <div class="caixa">Café Dostoyevsky</div>
                    </li>
                    <li id="parque_tematico" class="item">
                        <img src="img/mapas/parque.jpg">
                        <div class="caixa">Parque Temático</div>
                    </li>
                    <li id="litoral" class="item">
                        <img src="img/mapas/litoral.jpg">
                        <div class="caixa">Litoral</div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <form style="display: none;" id="form_num">
        <input id="id_num" name="num">
    </form>
    <footer style="margin-top: 15px;">
        <div>
            <p>Desenvolvido por Kaique F. Lucena</p>
        </div>
        <p>Minhas redes:</p>
        <ul>
            <li> <a href="https://www.linkedin.com/in/kaique-lucena-1383401a2/" target="_blank"><i class="fab fa-linkedin-in"></i></a></li>
            <li> <a href="https://github.com/KaiqueFigu1" target="_blank"><i class="fab fa-github"></i></a></li>
        </ul>
    </footer>
    
</body>

</html>

<script>
    verificar_autenticacao()

    function buscarLobby(){
        let formNum = document.getElementById('form_num')
        let idNum = document.getElementById('id_num')
        fetch(`/usuarios/contarjogadores`
        ).then(function (resposta) {

            if (resposta.ok) {
                
                resposta.json().then(function (jogadores) {
                    let random = parseInt(Math.random() * jogadores.length) + 1;
                    idNum.value = random;
                    console.log('ID jogador sorteado:' + random);
                    selecionarJogador();
                    selecionarMapa();
                });
            }
        });
    }

    function selecionarJogador(){
        let formNum = new URLSearchParams(new FormData(form_num));
        fetch('/usuarios/selecionarjogador',{
            method: 'POST',
            body: formNum
        }).then(function(resposta){
            if(resposta.ok){
                resposta.json().then(function (jogadorSelecionado) {
                    console.log(jogadorSelecionado[0].nickname);
                    let bAdversario = document.getElementById('b_adversario');
                    let divAdversario = document.getElementById('div_adversario')
                    divAdversario.style.display = 'block'
                    bAdversario.innerHTML = jogadorSelecionado[0].nickname;

                });
            }
        })
    }

    function selecionarMapa(){
        fetch('/usuarios/sortearmapa',{
            method: 'GET'
        }).then(function(resposta){
            if(resposta.ok){
                resposta.json().then(function(res){
                    let mapaSorteado = document.getElementById(`${res.mapa}`);
                    let mapaConteudo = mapaSorteado.innerHTML
                    let ulMap = document.getElementById('lmapas');
                    let li = document.createElement('li');
                    let h3Mapa = document.getElementById('h3_mapa');

                    h3Mapa.style.display = 'block'
                    li.className = 'item';
                    ulMap.innerHTML = '';
                    ulMap.appendChild(li);
                    li.innerHTML = mapaConteudo;
                })
            }
        })
    }
</script>